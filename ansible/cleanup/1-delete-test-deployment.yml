---
- name: Delete feature deployment for given branch
  hosts: all
  become: true
  tasks:
    - name: Get current git branch
      ansible.builtin.set_fact:
        branch: "{{ lookup('pipe', 'git symbolic-ref -q --short HEAD || git rev-parse --short HEAD') }}"
    - name: Remove feature deployment directory
      when: branch != "" and branch != "main"
      ansible.builtin.file:
        path: "/var/www/features/{{ branch }}"
        state: absent
